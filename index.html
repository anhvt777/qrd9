<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BIDV - Tra c·ª©u QR n·ªôp thu·∫ø</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
    header { background:#20B2AA; color:white; padding:10px; text-align:center; }
    header h1 { margin:0; font-size:20px; }
    header marquee { color:yellow; font-size:14px; white-space:nowrap; overflow:hidden; }
    .container { padding:15px; }
    .filters { margin-bottom:10px; display:flex; flex-wrap:wrap; gap:10px; }
    input, select { padding:8px; font-size:14px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; background:white; }
    th, td { border:1px solid #ccc; padding:6px; text-align:left; font-size:13px; }
    th { background:#20B2AA; color:white; }
    .pagination { margin-top:10px; text-align:center; }
    .pagination button { padding:6px 12px; margin:2px; border:none; background:#20B2AA; color:white; cursor:pointer; }
    .pagination button:disabled { background:#ccc; cursor:not-allowed; }
    #qrBox { display:none; margin-top:15px; padding:10px; border:1px solid #ccc; background:#fff; text-align:center; }
    #qrBox h3 { margin-top:0; color:#20B2AA; }
    #qrBox img { max-width:280px; }
  </style>
</head>
<body>
  <header>
    <h1>BIDV - C√¥ng c·ª• tra c·ª©u QR n·ªôp thu·∫ø</h1>
    <marquee behavior="scroll" direction="left">BIDV ƒë·ªìng h√†nh c√πng Nh√† n∆∞·ªõc - Thu thu·∫ø nhanh ch√≥ng qua QR Code</marquee>
  </header>
  <div class="container">
    <div class="filters">
      <input type="text" id="searchBox" placeholder="üîç Nh·∫≠p t√™n ho·∫∑c m√£ s·ªë thu·∫ø...">
      <select id="phuongSelect"><option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option></select>
      <select id="thonSelect"><option value="">Ch·ªçn Th√¥n/T·ªï</option></select>
    </div>
    <div id="qrBox">
      <h3>M√£ QR n·ªôp thu·∫ø</h3>
      <img id="qrImage" src="" alt="QR">
      <p id="qrInfo"></p>
    </div>
    <table id="dataTable">
      <thead>
        <tr>
          <th>T√™n t√†i kho·∫£n</th>
          <th>M√£ s·ªë thu·∫ø</th>
          <th>Ph∆∞·ªùng/X√£</th>
          <th>Th√¥n/T·ªï</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="pagination" id="pagination"></div>
  </div>
  <script>
    let data = [];
    const rowsPerPage = 50;
    let currentPage = 1;
    let filteredData = [];

    // Load d·ªØ li·ªáu t·ª´ data.json
    fetch("data.json")
      .then(res => res.json())
      .then(json => {
        data = json;
        filteredData = data;
        populatePhuongOptions();
        renderTable();
      });

    function populatePhuongOptions() {
      const phuongSet = [...new Set(data.map(d => d["PH∆Ø·ªúNG/X√É"]))];
      const select = document.getElementById("phuongSelect");
      phuongSet.forEach(p => {
        if(p){
          const opt = document.createElement("option");
          opt.value = p; opt.textContent = p;
          select.appendChild(opt);
        }
      });
    }

    function populateThonOptions(phuong) {
      const select = document.getElementById("thonSelect");
      select.innerHTML = "<option value=''>Ch·ªçn Th√¥n/T·ªï</option>";
      if (phuong) {
        const thonSet = [...new Set(data.filter(d => d["PH∆Ø·ªúNG/X√É"]===phuong).map(d => d["TH√îN/T·ªî/KHU PH·ªê"]))];
        thonSet.forEach(t => {
          if(t){
            const opt = document.createElement("option");
            opt.value = t; opt.textContent = t;
            select.appendChild(opt);
          }
        });
      }
    }

    function renderTable() {
      const tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      const start = (currentPage-1)*rowsPerPage;
      const pageData = filteredData.slice(start, start+rowsPerPage);
      pageData.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.AccountName || ""}</td><td>${row.MST || ""}</td><td>${row["PH∆Ø·ªúNG/X√É"] || ""}</td><td>${row["TH√îN/T·ªî/KHU PH·ªê"] || ""}</td>`;
        tr.onclick = () => showQR(row);
        tbody.appendChild(tr);
      });
      renderPagination();
    }

    function renderPagination() {
      const totalPages = Math.ceil(filteredData.length/rowsPerPage);
      const container = document.getElementById("pagination");
      container.innerHTML = "";
      for (let i=1;i<=totalPages;i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.disabled = i===currentPage;
        btn.onclick = () => { currentPage=i; renderTable(); };
        container.appendChild(btn);
      }
    }

    function showQR(row) {
      const qrUrl = `https://img.vietqr.io/image/${row.BankBin}-${row.AccountNumber}-compact.png?amount=${row.Amount||""}&addInfo=${encodeURIComponent(row.Remark||"")}&accountName=${encodeURIComponent(row.AccountName||"")}`;
      document.getElementById("qrImage").src = qrUrl;
      document.getElementById("qrInfo").textContent = `${row.AccountName || ""} - MST: ${row.MST || ""}`;
      document.getElementById("qrBox").style.display = "block";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function applyFilters() {
      const keyword = document.getElementById("searchBox").value.toLowerCase();
      const phuong = document.getElementById("phuongSelect").value;
      const thon = document.getElementById("thonSelect").value;
      filteredData = data.filter(r => {
        return (!keyword || (r.AccountName && r.AccountName.toLowerCase().includes(keyword)) || (r.MST && r.MST.toString().includes(keyword)))
          && (!phuong || r["PH∆Ø·ªúNG/X√É"]===phuong)
          && (!thon || r["TH√îN/T·ªî/KHU PH·ªê"]===thon);
      });
      currentPage = 1;
      renderTable();
    }

    document.getElementById("searchBox").addEventListener("input", applyFilters);
    document.getElementById("phuongSelect").addEventListener("change", (e)=>{
      populateThonOptions(e.target.value);
      applyFilters();
    });
    document.getElementById("thonSelect").addEventListener("change", applyFilters);
  </script>
</body>
</html>
